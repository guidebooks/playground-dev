(self.webpackChunkKuiClientTemplate=self.webpackChunkKuiClientTemplate||[]).push([[9083,3228,561],{51956:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>p,doExec:()=>v});var i=t(11227),o=t.n(i),s=t(37767),r=t(18495);const c=o()("plugins/bash-like/util/json");var a=t(67712),d=t(186),l=function(e,n,t,i){return new(t||(t=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,c)}a((i=i.apply(e,n||[])).next())}))};const u=o()("plugins/bash-like/cmds/general");const v=(e,n,t)=>t.onInit||t.onExit||!r.Capabilities.isHeadless()||r.Capabilities.inProxy()?new Promise(((n,i)=>l(void 0,void 0,void 0,(function*(){try{const o={maxBuffer:1048576,cwd:t.cwd,env:Object.assign({},d.env,t.env||{})};d.env.SHELL&&(o.shell=d.env.SHELL);const r=(0,s.exec)(e,o);let a,v="",f="";t.onInit&&(u("setting up stdout via onInit",e.slice(0,10)),a=Promise.resolve(t.onInit({abort:()=>r.kill(),xon:()=>{},xoff:()=>{},write:()=>{}}))),t.pipeStdin&&d.stdin.pipe(r.stdin),r.stdout.on("data",(e=>l(void 0,void 0,void 0,(function*(){const n=e.toString();a?(yield a)(e):v+=n})))),r.stderr.on("data",(e=>l(void 0,void 0,void 0,(function*(){f+=e,t.stderr?t.stderr(e.toString()):a?(yield a)(e.toString()):u(e.toString())})))),r.on("error",i),r.on("close",(o=>l(void 0,void 0,void 0,(function*(){if(t.onExit)return u("onExit",o,e.slice(0,10)),void t.onExit(o);if(0===o)if(t&&t.json)try{n(JSON.parse(v))}catch(e){const n=new Error("unexpected non-JSON");n.value=v,i(n)}else if(t&&t.raw)n(v);else if(v||f){const e=(e=>{const n=e.substring(e.indexOf("{"));if(n.length>0)try{const e=JSON.parse(n);return c("successfully parsed out json",e),e}catch(e){}})(v);e&&"object"==typeof e?(e.type="shell",e.verb="get",n(e)):n(v)}else n(!0);else{u("non-zero exit code",o);const e=f.replace(/(^\/[^/]+\/[^:]+: )(line \d+: )?/,"");try{((e,n,t,i,o,s)=>{const r=0===i.length?t:i;if(o&&o.nested&&n<127){const e=new Error(r);throw e.code=n,e}{const e=new Error(r);throw e.html=s,o.stderr?e.code=s:/File exists/i.test(r)?e.code=409:127!==n&&/not found/i.test(r)?e.code=404:e.code=n,e}})(0,o,v,e,t)}catch(e){i(e)}}}))))}catch(e){i(e)}})))):function(e,n){return new Promise(((t,i)=>l(this,void 0,void 0,(function*(){try{const o={cwd:n.cwd,env:Object.assign({},d.env,n.env||{})};d.env.SHELL&&e.find((e=>/&&|>|\||`|\$/.test(e)))&&(o.shell=d.env.SHELL),n.onInit||n.onExit||!r.Capabilities.isHeadless()||r.Capabilities.inProxy()||(o.stdio="inherit");const c=(0,s.spawn)(e[0],e.slice(1),o);c.on("error",i),c.on("close",(e=>l(this,void 0,void 0,(function*(){0===e?t(!0):i(new Error(`non-zero exit code: ${e}`))}))))}catch(e){i(e)}}))))}(n,t),f=e=>{if(e.execOptions.type===r.ExecType.TopLevel)throw new Error("this command is intended for internal consumption only");return(0,a.XN)(e)},p=e=>{e.listen("/!",a.XN,{docs:"Execute a UNIX shell command",requiresLocal:!0}),e.listen("/sendtopty",f,{docs:"Execute a UNIX shell command with a PTY",hidden:!0}),e.listen("/pwd",(()=>d.env.PWD||d.env.HOME||"/"))}},67712:(e,n,t)=>{"use strict";t.d(n,{XN:()=>a,Io:()=>d,MA:()=>l});var i=t(11227),o=t.n(i),s=t(16426),r=function(e,n,t,i){return new(t||(t=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,c)}a((i=i.apply(e,n||[])).next())}))};const c=o()("plugins/bash-like/cmds/catchall"),a=({tab:e,REPL:n,command:i,argv:o,argvNoOptions:c,execOptions:a,parsedOptions:d,createOutputStream:l})=>r(void 0,void 0,void 0,(function*(){const r=e=>{if(e.message&&"string"==typeof e.message){const n=new Error(e.message.replace(/[a-zA-Z0-9/]+:\s*/,"").trim());throw n.code=e.code,n}throw e},{ExecType:u}=yield Promise.resolve().then(t.bind(t,18495)),v=(a.raw||a.type===u.Nested)&&void 0===a.quiet&&void 0===a.echo&&void 0===a.replSilence,f=v||a.isProxied?a:Object.assign({cwd:yield(0,s.Z)(a,n)},{stdout:yield l()},a),p=i.replace(/^(!|sendtopty)\s+/,""),{Capabilities:h}=yield Promise.resolve().then(t.bind(t,18495));if(h.isHeadless()||!h.inBrowser()&&v){const{doExec:e}=yield t.e(3228).then(t.bind(t,51956)),n="sendtopty"===o[0]?o.slice(1):o,i=yield e(p,n,f).catch(r);if(v&&("number"==typeof i||"boolean"==typeof i))return i;if(v&&"string"==typeof i)try{return isNaN(parseInt(i))?JSON.parse(i):i}catch(e){}return i}{const{doExec:i}=yield Promise.all([t.e(8575),t.e(9267),t.e(9224),t.e(2320),t.e(8885),t.e(116)]).then(t.bind(t,48885)),o=()=>i(e,n,p,c,d,f);if(v){f.quiet=!0,f.echo=!1,f.replSilence=!0;let e="";return f.onInit=()=>n=>{"string"==typeof n&&(e+=n)},o().then((()=>e)).catch(r)}return o().catch(r)}}));function d(e){return r(this,void 0,void 0,(function*(){const{Capabilities:n}=yield Promise.resolve().then(t.bind(t,18495));return new Promise(((t,i)=>r(this,void 0,void 0,(function*(){let o="";const s=Object.assign({},e.execOptions,{rethrowErrors:!0,quiet:!0,replSilence:!0,echo:!1,onInit:()=>e=>{"string"==typeof e&&(o+=e)}}),r=Object.assign({},e,{execOptions:s});yield a(r).catch((e=>{const t=o||e.message;o&&n.isHeadless()?c(t):c(e),e.message=t,i(e)})),t(o)}))))}))}const l=e=>r(void 0,void 0,void 0,(function*(){const{Capabilities:n}=yield Promise.resolve().then(t.bind(t,18495));if(!n.inBrowser()||n.hasProxy())return e.catchall((()=>!0),a,0);c("skipping catchall registration: in browser and no remote proxy to support it")}))},16426:(e,n,t)=>{"use strict";t.d(n,{Z:()=>s});var i=t(18495),o=function(e,n,t,i){return new(t||(t=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,c)}a((i=i.apply(e,n||[])).next())}))};function s(e,n){return o(this,void 0,void 0,(function*(){return e.cwd||((yield n.rexec(`vfs ls -d ${(0,i.encodeComponent)(i.Util.cwd())}`)).content[0].dirent.mount.isLocal?i.Util.cwd():i.Util.expandHomeDir("~"))}))}},30890:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>l});var i=t(51956),o=t(29224),s=t(18495),r=t(67712),c=function(e,n,t,i){return new(t||(t=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,c)}a((i=i.apply(e,n||[])).next())}))};const a=e=>c(void 0,void 0,void 0,(function*(){const{command:n,tab:t,parsedOptions:i}=e,o=s.SymbolTable.read(t),c=i._[1].split("=")[0],a=/;\s*$/.test(n)?"":";",d=Object.assign({},e,{command:`${n}${a} echo -n $${c}`}),l=yield(0,r.Io)(d);return o[c]=l,s.SymbolTable.write(t,o),s.Events.eventBus.emitEnvUpdate(c,l),!0})),d={command:"export",docs:"Export a variable or function to the environment of all the child processes running in the current shell",required:[{name:"key=value",docs:"an assignment of key to value"}]},l=e=>{return Promise.all([(0,i.default)(e),(0,o.default)(e),(n=e,void n.listen("/export",a,{usage:d}))]);var n}},37767:()=>{},67953:()=>{},10561:()=>{}}]);