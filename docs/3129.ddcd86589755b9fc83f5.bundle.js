"use strict";(self.webpackChunkKuiClientTemplate=self.webpackChunkKuiClientTemplate||[]).push([[3129],{3129:(e,n,i)=>{i.r(n),i.d(n,{getChannelForTab:()=>d,init:()=>p,invalidateSession:()=>v,pollUntilOnline:()=>f});var t=i(11227),o=i.n(t),s=i(18495);const r=o()("plugins/bash-like/pty/ui");var u=i(84932),a=function(e,n,i,t){return new(i||(i=Promise))((function(o,s){function r(e){try{a(t.next(e))}catch(e){s(e)}}function u(e){try{a(t.throw(e))}catch(e){s(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,u)}a((t=t.apply(e,n||[])).next())}))};const l=(0,s.i18n)("plugin-bash-like"),c=o()("plugins/bash-like/pty/session");function d(e){if((0,u.Lu)())throw new Error("Exiting");if(s.Capabilities.inBrowser())return(0,u.E6)(e)}function f(e){return new Promise((n=>{let i=!1;const t=setTimeout((()=>{i||(r("setOffline"),s.Events.eventChannelUnsafe.emit("/proxy/offline"))}),5e3),o=(a=0)=>(c("trying to establish session",e),e.REPL.qexec("echo initializing session",void 0,void 0,{tab:e}).then((()=>{i=!0,clearTimeout(t),r("setOnline"),s.Events.eventChannelUnsafe.emit("/proxy/online"),n()})).catch((n=>{const i=n;return 503!==i.code&&(console.error("error establishing session",i.code,i.statusCode,i),(0,u.e5)(e)),setTimeout((()=>o(a+1)),a<10?2e3:a<100?4e3:1e4),l("Could not establish a new session")})));o()}))}function h(e){return a(this,void 0,void 0,(function*(){const n=(0,u.E6)(e)||new Promise(((n,i)=>a(this,void 0,void 0,(function*(){try{yield f(e),e.classList.add("kui--session-init-done"),n(yield d(e))}catch(e){i(e)}}))));yield n,e.classList.add("kui--session-init-done")}))}function v(e){(0,u.e5)(e),s.Events.eventBus.emit("/tab/offline",e),s.Events.eventBus.emitWithTabId("/tab/offline",e.state.uuid)}function p(e){return a(this,void 0,void 0,(function*(){const{proxyServer:n}=yield i.e(1668).then(i.t.bind(i,17186,19)).catch((()=>(console.log("using default proxy configuration"),{proxyServer:{enabled:!1}})));s.Capabilities.inBrowser()&&!1!==n.enabled&&(c("initializing pty sessions"),e.registerSessionInitializer(h))}))}},84932:(e,n,i)=>{i.d(n,{Lu:()=>s,e5:()=>r,E6:()=>u,oY:()=>a});let t,o=!1;function s(){return o}function r(e){t=void 0}function u(e){return t}function a(e,n){return t=n,n.then((e=>{window.addEventListener("beforeunload",(()=>{o=!0,e.close()}))})),t}}}]);