(self.webpackChunkKuiClientTemplate=self.webpackChunkKuiClientTemplate||[]).push([[6314],{86481:(t,e,n)=>{"use strict";n.d(e,{Q:()=>a,Z:()=>s});var o=n(347),i=n(28724),r=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};function a(t,e){return r(this,void 0,void 0,(function*(){const n=(yield t.REPL.qexec(`kubectl get all -n ${e} -o custom-columns=KIND:.kind`)).body.reduce(((t,{name:e})=>(t[e]=(t[e]||0)+1,t)),{});return{header:{name:"KIND",attributes:[{key:"COUNT",value:"COUNT"}]},body:Object.keys(n).map((t=>({name:t,onclick:`kubectl get ${t} -n ${e}`,attributes:[{key:"COUNT",value:n[t].toLocaleString()}]}))).sort(((t,e)=>n[e.name]-n[t.name]))}}))}function c(t){const e=t.argvNoOptions[t.argvNoOptions.length-1];return a(t.tab,e)}function u({tab:t}){return r(this,void 0,void 0,(function*(){return(yield(0,o.getCurrentContext)(t)).metadata.namespace}))}const s=t=>{t.listen("/namespace/current",u,i.L6),t.listen("/namespace/summarize",c,i.L6)}},68215:(t,e,n)=>{"use strict";function o(t){return"IP"===t?t:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function i(t){return t.body.reduce(((t,e)=>(t[o(e.key)]=e.name,e.attributes.forEach((({key:e,value:n})=>{t[o(e)]=n})),t)),{})}n.d(e,{k:()=>o,Z:()=>i})},73836:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>nt});var o=n(18495),i=n(72890),r=n(94194),a=n(98919),c=n(36156),u=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};const s=t=>e=>u(void 0,void 0,void 0,(function*(){if((0,c.lN)(e))return(0,c.t$)(t,e);{const n=yield(0,r.GL)(e,void 0,t),{content:{stderr:i,stdout:c}}=n;if((0,o.isXtermResponse)(c))return c;const u=yield(0,a.rW)(c,i,e,t,"explain","api-resources");return(0,o.isTable)(u)&&(u.body.forEach((e=>{const n=e.attributes[3]&&e.attributes[3].value||e.name;e.onclick=`${t} explain ${n}`})),u.body.sort(((t,e)=>t.name.localeCompare(e.name)))),u}}));var l=n(347),d=n(67039),f=n(68215);function p(t,e){return o.Util.flatten([t,`${t}s`].concat(e?[e]:[]).map((t=>[t,(0,f.k)(t)])))}var m=n(28724),v=n(84323),h=n(50816),y=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};function b(t){return y(this,void 0,void 0,(function*(){const e=yield(0,m.gc)((0,h.fY)(t))(t);if((0,o.isTable)(e)&&e.header){(0,a.ei)("up-to-date",e);const t=e.header.attributes.findIndex((t=>/Ready/i.test(t.key)));t>=0&&((0,a.ov)(t,e),e.statusColumnIdx=t,e.body.forEach((e=>{const n=e.attributes[t];if(n&&n.value){const t=n.value.match(/(\d+)\/(\d+)/);if(t&&3===t.length){n.tag="badge";const e=parseInt(t[1],10),o=parseInt(t[2],10);n.css=e===o?v.Z.Green:0===e?v.Z.Red:v.Z.Yellow}}})))}return e}))}const k=t=>{var e,n,i,r;(e="deployment",n="deploy",i="v1",r="apps",i?o.Util.flatten(p(e,n).map((t=>[t,`${t}.${r}`,`${t}.${i}.${r}`]))):p(e,n)).forEach((e=>{["k","kubectl","oc"].forEach((n=>{t.listen(`/${n}/get/${e}`,b,m.L6)}))}))};var x=n(76600),w=n(26470),g=n(58853),$=n(25218),O=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};const P=(0,o.i18n)("plugin-kubectl"),N=t=>function(e){return O(this,void 0,void 0,(function*(){if((0,c.lN)(e))return(0,c.t$)(t,e);try{const{REPL:n}=e,i=(0,g.$L)(e);if("string"!=typeof i)throw new Error("multi-file diff currently unsupported");const r=o.Util.findFile(o.Util.expandHomeDir(i)),a=(0,w.basename)(i),c=(0,w.dirname)(i),u="."===c?void 0:c,[s,l]=yield Promise.all([n.qexec((0,g.QG)(e,`${t} get ${(0,g.W2)(e)} -o yaml`)),n.qexec((0,g.QG)(e,`${t} apply ${(0,g.W2)(e)} --dry-run=server -o yaml`))]);if(console.error("previous",s),console.error("current",l),(0,$.Ib)(s)&&(0,$.Ib)(l)){const t={mode:"diff",label:P("Pending Changes"),content:{a:(0,h.p2)(s.kuiRawData),b:(0,h.p2)(l.kuiRawData)},contentType:"yaml"};return{apiVersion:"kui-shell/v1",kind:"File",metadata:{name:a,namespace:u},toolbarText:{type:"info",text:P("Showing changes between the working tree and previous commit.")},modes:[t],spec:{filepath:i,fullpath:r,size:0}}}throw new Error("failed to get resources")}catch(n){return console.error("error at kubectl diff",n),(0,r.GL)(e,void 0,t)}}))};function Z(t,e,n=e){t.listen(`/${e}/diff`,N(n))}var E=n(70764),T=n(42177),L=n(66167),C=n(86481),R=n(88363),I=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};const z=(0,o.i18n)("plugin-kubectl","kustomize");function U(t){const e=t.argvNoOptions.indexOf("kustomize"),n=t.argvNoOptions[e+1];return n?t.command.replace(new RegExp(n,"g"),o.Util.expandHomeDir(n)):t.command}function G(t,e){const n=e.split(/---/),o=t.reduce(((t,e,o)=>{const i=(0,R.H1)(e);return t[i]||(t[i]={label:i,items:[]}),t[i].items.push({mode:e.metadata.name,content:n[o].replace(/^\n/,""),contentType:"yaml"}),t}),{}),i={label:z("Raw Data"),items:[{mode:"YAML",content:e,contentType:"yaml"}]};return Object.values(o).concat([i])}const j=(t="kubectl")=>e=>I(void 0,void 0,void 0,(function*(){if((0,c.lN)(e))return(0,c.t$)(t,e);{const[o,{loadAll:i}]=yield Promise.all([(0,r.d1)(e,U,t),n.e(8163).then(n.bind(n,78163))]);try{const t=i(o),n=(0,w.resolve)(e.argvNoOptions[e.argvNoOptions.indexOf("kustomize")+1]);return{apiVersion:"kui-shell/v1",kind:"NavResponse",breadcrumbs:[{label:"kustomize"},{label:(0,w.basename)(n),command:`open ${n}`}],menus:G(t,o)}}catch(t){return console.error("error preparing kustomize response",t),o}}}));var A=n(72400),D=n(83923),S=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};const q="top",B=t=>function(e){return S(this,void 0,void 0,(function*(){if((0,c.lN)(e))return(0,c.t$)(t,e);{const n=yield(0,r.GL)(e);return(0,m.Bm)(t,e,n,q)}}))};var K=n(87500),Q=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};function F(t){["kubectl","k"].forEach((e=>{const n=(0,m.gc)(e);var i,r,a;(i="job",r="v1",a="batch",o.Util.flatten(o.Util.flatten([i,`${i}s`].map((t=>[t,(0,f.k)(t)]))).map((t=>[t,`${t}.${a}`,`${t}.${r}.${a}`])))).forEach((i=>{t.listen(`/${e}/get/${i}`,(t=>Q(this,void 0,void 0,(function*(){if((0,g.QI)(t))return n(t);const e=t.argvNoOptions.slice(t.argvNoOptions.indexOf(i)+1),r=0===e.length?"job-name":`'job-name in (${e.join(",")})'`,a=(0,g.QG)(t,`kubectl get pod -l ${r} --sort-by={.status.startTime} -o custom-columns=JOB:.metadata.ownerReferences[0].name,NAME:.metadata.name,STATUS:.status.phase,START:.status.startTime,START2:.status.containerStatuses[0].state.terminated.startedAt,END:.status.containerStatuses[0].state.terminated.finishedAt ${(0,g.nf)(t)} ${t.parsedOptions.limit?`--limit ${t.parsedOptions.limit}`:"--limit 200"}`),c=yield t.REPL.qexec(a,void 0,void 0,t.execOptions);return(0,o.isTable)(c)?(c.title="Job",c):c}))),m.L6)}))}))}var _=n(82216),H=n(11227),W=n.n(H),Y=n(76299),J=n(48764).Buffer,M=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};const V=W()("plugin-kubectl/controller/fetch-file");function X(t){return M(this,void 0,void 0,(function*(){const{lstat:e}=yield n.e(7935).then(n.t.bind(n,27935,23));return new Promise(((n,o)=>{e(t,((t,e)=>{t?"ENOENT"===t.code?n(!1):o(t):n(e.isFile())}))}))}))}function tt(t,e){return M(this,void 0,void 0,(function*(){const[o,{join:i}]=yield Promise.all([X(e),Promise.resolve().then(n.t.bind(n,26470,23))]);if(o)return{data:yield(0,Y.LG)(t,e)[0]};{const n=i(e,"kustomization.yml"),o=i(e,"kustomization.yaml"),r=i(e,"Kustomization"),[a,c,u]=yield Promise.all([X(n),X(o),X(r)]),s=e;if(a)return{data:(yield(0,Y.LG)(t,n))[0]||"",dir:s};if(c)return{data:(yield(0,Y.LG)(t,o))[0]||"",dir:s};if(u)return{data:(yield(0,Y.LG)(t,r))[0]||"",dir:s}}}))}var et=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((o=o.apply(t,e||[])).next())}))};const nt=t=>et(void 0,void 0,void 0,(function*(){var e;(t=>{t.listen("/kubectl/api-resources",s("kubectl"),i.Z),t.listen("/k/api-resources",s("kubectl"),i.Z)})(t),(0,l.default)(t),(0,d.ZP)(t),(0,x.Z)(t),(t=>{Z(t,"kubectl"),Z(t,"k","kubectl")})(t),(0,T.ZP)(t),(0,E.ZP)(t),(0,L.Z)(t),F(t),(0,m.ZP)(t),(0,C.Z)(t),k(t),(t=>{t.listen("/kubectl/kustomize",j(),i.Z),t.listen("/k/kustomize",j(),i.Z)})(t),(0,A.ZP)(t),(0,D.Z)(t),(e=t).listen("/kubectl/top/node",B("kubectl"),i.Z),e.listen("/k/top/node",B("k"),i.Z),e.listen("/kubectl/top/pod",B("kubectl"),i.Z),e.listen("/k/top/pod",B("k"),i.Z),(0,K.ZP)(t),(0,_.ZP)(t),(t=>{t.listen("/_openstream",(t=>M(void 0,void 0,void 0,(function*(){const e=t.argvNoOptions[t.argvNoOptions.indexOf("_openstream")+1],n="object"!=typeof t.execOptions.data||J.isBuffer(t.execOptions.data)?void 0:t.execOptions.data.headers;if(V("openstream",e),!t.execOptions.onInit)throw new Error("Internal Error: onInit required");return new Promise(((o,i)=>M(void 0,void 0,void 0,(function*(){try{yield(0,Y.Cg)(t,e,{onInit:t.execOptions.onInit,onReady:t.execOptions.onReady,onExit:e=>{V("got exit from stream",e),t.execOptions.onExit&&t.execOptions.onExit(e),o(!0)}},n)}catch(t){i(t)}}))))}))),{requiresLocal:!0}),t.listen("/_fetchfile",(t=>M(void 0,void 0,void 0,(function*(){const{argvNoOptions:e,parsedOptions:n,execOptions:o}=t,i=e[e.indexOf("_fetchfile")+1],r="object"!=typeof o.data||J.isBuffer(o.data)?void 0:o.data;return n.kustomize?{mode:"raw",content:yield tt(t,i)}:{mode:"raw",content:yield(0,Y.dc)(t,i,r)}}))),{requiresLocal:!0,flags:{boolean:["kustomize"]}})})(t),(t=>{o.Capabilities.inBrowser()&&!o.Capabilities.hasProxy()||t.catchall((t=>{return e=t[0],/^k(ubectl)?$/.test(e);var e}),(t=>(0,c.lN)(t)?(0,c.t$)("kubectl",t):(0,r.fF)(t)),1)})(t)}))},47689:()=>{}}]);