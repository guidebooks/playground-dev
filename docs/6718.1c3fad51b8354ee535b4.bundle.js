"use strict";(self.webpackChunkKuiClientTemplate=self.webpackChunkKuiClientTemplate||[]).push([[6718],{57629:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var o=n(67294),i=n(26470),M=n(27877),a=n(94523),r=n(18495),c=n(55080);const l=(0,r.i18n)("plugin-client-common","editor");function s(e,t){return{mode:"Clear",kind:"view",icon:o.createElement(c.default,{icon:"Clear"}),label:l("Clear"),command:()=>{e.setValue(""),t&&t()}}}var A=function(e,t,n,o){return new(n||(n=Promise))((function(i,M){function a(e){try{c(o.next(e))}catch(e){M(e)}}function r(e){try{c(o.throw(e))}catch(e){M(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};const u=(0,r.i18n)("plugin-client-common","editor");var D=function(e,t,n,o){return new(n||(n=Promise))((function(i,M){function a(e){try{c(o.next(e))}catch(e){M(e)}}function r(e){try{c(o.throw(e))}catch(e){M(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};const d=(0,r.i18n)("plugin-client-common","editor");var p=n(12079),g=n(36073),w=n(36483),j=function(e,t,n,o){return new(n||(n=Promise))((function(i,M){function a(e){try{c(o.next(e))}catch(e){M(e)}}function r(e){try{c(o.throw(e))}catch(e){M(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};const I=(0,r.i18n)("plugin-client-common","editor");class T extends o.PureComponent{constructor(e){super(e),this.state={content:e.content,cleaners:[],editor:void 0,wrapper:void 0,catastrophicError:void 0}}static getDerivedStateFromError(e){return{catastrophicError:e}}componentDidCatch(e,t){console.error("catastrophic error in Editor",e,t)}static allClean(e){return{type:"info",text:I(e?"isUpToDateReadonly":"isUpToDate")}}static error(e,t,...n){return{type:"error",text:I(t,...n)}}static getDerivedStateFromProps(e,t){return!t.editor&&t.wrapper?T.initMonaco(e,t):t.content&&e.content.content===t.content.content&&e.content.contentType===t.content.contentType?t:{content:e.content,subscription:T.reinitMonaco(e,t,T.isReadOnly(e,t))}}componentWillUnmount(){this.destroyMonaco()}destroyMonaco(){this.state.cleaners.forEach((e=>e()))}static isClearable(e,t){return(0,a.zE)(e.response)&&!e.readOnly||!(0,a.zE)(e.response)&&t.spec&&!1!==t.spec.clearable}static onChange(e,t,n,i){let r;return l=>{if(2===l.versionId)return;r&&(i.deltaDecorations(r,[]),r=void 0);const p=T.isClearable(e,t),g=[];if((0,a.zE)(e.response)){const t=function(e,t,n,i){return{mode:"Save",kind:"view",label:u("saveLocalFile"),icon:o.createElement(c.default,{icon:"Save"}),command:()=>A(this,void 0,void 0,(function*(){try{yield t.rexec(`vfs fwrite ${t.encodeComponent(n.spec.fullpath)}`,{data:e.getValue()}),i(!0)}catch(e){i(!1)}}))}}(i,e.repl,e.response,(t=>{t?e.willUpdateToolbar(T.allClean(n),p?[s(i)]:void 0):e.willUpdateToolbar(T.error(e,"errorSaving"))}));g.push(t)}else if(t.spec&&t.spec.save){const{onSave:a}=t.spec.save;g.push({mode:"Save",label:t.spec.save.label||I("saveLocalFile"),kind:"drilldown",icon:o.createElement(c.default,{icon:"Save"}),inPlace:!0,command:()=>j(this,void 0,void 0,(function*(){try{const t=yield a(i.getValue());if(t&&t.noToolbarUpdate||e.willUpdateToolbar(t&&t.toolbarText||T.allClean(n),p?[s(i)]:void 0),t&&t.command)return t.command}catch(t){const n=t;n.revealLine&&(i.revealLineInCenter(n.revealLine),r=i.deltaDecorations(r||[],[{range:new M.Range(n.revealLine,1,n.revealLine,1),options:{isWholeLine:!0,className:"kui--editor-line-highlight",glyphMarginClassName:"kui--editor-line-glyph"}}]));const o={type:"warning",text:I("isModified"),alerts:[{type:"error",title:I("errorApplying"),body:n.message}]};e.willUpdateToolbar(o,g,void 0)}}))})}if((0,a.zE)(e.response)){const t=function(e,t,n,i){return{mode:"Revert",kind:"view",label:d("revert"),icon:o.createElement(c.default,{icon:"Revert"}),command:()=>D(this,void 0,void 0,(function*(){try{const e=(yield t.rexec(`vfs fstat ${t.encodeComponent(n.spec.fullpath)} --with-data --enoent-ok`)).content;i(!0,e.data)}catch(e){i(!1)}}))}}(0,e.repl,e.response,((t,o)=>{t?(i.setValue(o),e.willUpdateToolbar(T.allClean(n),p?[s(i)]:void 0)):e.willUpdateToolbar(T.error(e,"errorReverting"))}));g.push(t)}else if(t.spec&&t.spec.revert){const{onRevert:M}=t.spec.revert;g.push({mode:"Revert",label:t.spec.revert.label||I("revert"),kind:"view",icon:o.createElement(c.default,{icon:"Revert"}),command:()=>j(this,void 0,void 0,(function*(){try{const t=yield M();i.setValue(t),e.willUpdateToolbar(T.allClean(n),p?[s(i)]:void 0)}catch(t){console.error(t),e.willUpdateToolbar(T.error(e,"errorReverting"))}}))})}p&&g.push(s(i)),e.willUpdateToolbar({type:"warning",text:I("isModified")},g)}}static subscribeToChanges(e,t,n,o){if(e.willUpdateToolbar){const i=o&&e.response.toolbarText||!o&&T.allClean(o),M=e.response.toolbarText?[]:T.isClearable(e,t)?[s(n)]:void 0;return e.willUpdateToolbar(i,M),n.onDidChangeModelContent(T.onChange(e,t,o,n))}}static extractValue(e,t,n){return j(this,void 0,void 0,(function*(){try{return"string"==typeof e.content&&0!==e.content.length||!(0,a.zE)(t)?e.content:yield n.qexec(`vfs fslice ${(0,r.encodeComponent)(t.spec.fullpath)} 0 8192`)}catch(e){return console.error(e),e.message}}))}static reinitMonaco(e,t,n){return setTimeout((()=>j(this,void 0,void 0,(function*(){t.editor.setValue(yield T.extractValue(e.content,e.response,e.repl));const o=n&&e.response.toolbarText||!n&&T.allClean(n);e.willUpdateToolbar(o,T.isClearable(e,e.content)?[s(t.editor)]:void 0),t.subscription&&t.subscription.dispose()})))),T.subscribeToChanges(e,e.content,t.editor,T.isReadOnly(e,t))}static isReadOnly(e,t){return!(0,a.zE)(e.response)&&(!t.content.spec||!1!==t.content.spec.readOnly)&&(e.readOnly||!(0,a.zE)(e.response)||!1)}static initMonaco(e,t){const n=[];try{const o={value:"",readOnly:T.isReadOnly(e,t),language:"text/plain"===t.content.contentType?(0,g.d)(t.content.contentType,(0,a.zE)(e.response)?(0,i.extname)(e.response.spec.filepath).slice(1):void 0):t.content.contentType||void 0},c={theme:e.light?"vs":"vs-dark"},l=Object.assign((0,w.Z)(o),o,c),s=M.editor.create(t.wrapper,l);setTimeout((()=>j(this,void 0,void 0,(function*(){s.setValue(yield T.extractValue(t.content,e.response,e.repl)),s.getAction("editor.foldLevel2").run()}))));const A=()=>{s.updateOptions({fontSize:(0,p.Z)()})};r.Events.eventChannelUnsafe.on("/zoom",A),n.push((()=>r.Events.eventChannelUnsafe.off("/zoom",A)));const u=e.sizeToFit?(e,n=Math.min(.4*window.innerHeight,Math.max(250,s.getContentHeight())))=>{t.wrapper.style.flexBasis=n+"px"}:()=>!0;u();const D=new ResizeObserver((e=>{u(e[0].contentRect.width,e[0].contentRect.height),s.layout()}));D.observe(t.wrapper),n.push((()=>D.disconnect()));const d=()=>{u(),s.layout()};r.Events.eventBus.onTabLayoutChange(e.tabUUID,d),n.push((()=>r.Events.eventBus.offTabLayoutChange(e.tabUUID,d))),s.clearDecorations=()=>{const e=[{range:new M.Range(1,1,1,1),options:{}}];s.__cloudshell_decorations=s.deltaDecorations(s.__cloudshell_decorations||[],e)},t.wrapper.getValueForTests=()=>s.getValue(),l.readOnly||setTimeout((()=>s.focus()));const I=T.subscribeToChanges(e,e.content,s,l.readOnly);return I&&n.push((()=>I.dispose())),n.push((()=>{s.dispose();const e=s.getModel();e&&e.dispose()})),{editor:s,cleaners:n,subscription:I}}catch(e){return console.error("Error initing Monaco: ",e),t.catastrophicError=e,t}}render(){return this.state.catastrophicError?o.createElement("div",{className:"oops"}," ",this.state.catastrophicError.toString()):o.createElement("div",{className:"code-highlighting"},o.createElement("div",{className:"monaco-editor-wrapper",ref:e=>this.setState({wrapper:e})}))}}},36073:(e,t,n)=>{n.d(t,{d:()=>M});var o=n(11227);const i=n.n(o)()("plugins/editor/file-types"),M=(e,t)=>{const n=t||e.substring(0,e.indexOf(":"))||e;return i("language",e,t,n),"nodejs"===n||"app"===n||"composition"===n||"sequence"===n||"js"===n?"javascript":"ts"===n?"typescript":"md"===n?"markdown":"sh"===n?"shell":"yml"===n?"yaml":n}},94748:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAAHUlEQVQYV2PYvXu3JAi7uLiAMaYAjAGTQBPYLQkAa/0Zef3qRswAAAAASUVORK5CYII="},4768:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAL0lEQVQoz2NgCD3x//9/BhBYBWdhgFVAiVW4JBFKGIa4AqD0//9D3pt4I4tAdAMAHTQ/j5Zom30AAAAASUVORK5CYII="},35555:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAz0lEQVRIx2NgYGBY/R8I/vx5eelX3n82IJ9FxGf6tksvf/8FiTMQAcAGQMDvSwu09abffY8QYSAScNk45G198eX//yev73/4///701eh//kZSARckrNBRvz//+8+6ZohwCzjGNjdgQxkAg7B9WADeBjIBqtJCbhRA0YNoIkBSNmaPEMoNmA0FkYNoFKhapJ6FGyAH3nauaSmPfwI0v/3OukVi0CIZ+F25KrtYcx/CTIy0e+rC7R1Z4KMICVTQQ14feVXIbR695u14+Ir4gwAAD49E54wc1kWAAAAAElFTkSuQmCC"},6161:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCA1MyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwKSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNDguMDM2NCA0LjAxMDQySDQuMDA3NzlMNC4wMDc3OSAzMi4wMjg2SDQ4LjAzNjRWNC4wMTA0MlpNNC4wMDc3OSAwLjAwNzgxMjVDMS43OTcyMSAwLjAwNzgxMjUgMC4wMDUxODc5OSAxLjc5OTg0IDAuMDA1MTg3OTkgNC4wMTA0MlYzMi4wMjg2QzAuMDA1MTg3OTkgMzQuMjM5MiAxLjc5NzIxIDM2LjAzMTIgNC4wMDc3OSAzNi4wMzEySDQ4LjAzNjRDNTAuMjQ3IDM2LjAzMTIgNTIuMDM5IDM0LjIzOTIgNTIuMDM5IDMyLjAyODZWNC4wMTA0MkM1Mi4wMzkgMS43OTk4NCA1MC4yNDcgMC4wMDc4MTI1IDQ4LjAzNjQgMC4wMDc4MTI1SDQuMDA3NzlaTTguMDEwNDIgOC4wMTMwMkgxMi4wMTNWMTIuMDE1Nkg4LjAxMDQyVjguMDEzMDJaTTIwLjAxODIgOC4wMTMwMkgxNi4wMTU2VjEyLjAxNTZIMjAuMDE4MlY4LjAxMzAyWk0yNC4wMjA4IDguMDEzMDJIMjguMDIzNFYxMi4wMTU2SDI0LjAyMDhWOC4wMTMwMlpNMzYuMDI4NiA4LjAxMzAySDMyLjAyNlYxMi4wMTU2SDM2LjAyODZWOC4wMTMwMlpNNDAuMDMxMiA4LjAxMzAySDQ0LjAzMzlWMTIuMDE1Nkg0MC4wMzEyVjguMDEzMDJaTTE2LjAxNTYgMTYuMDE4Mkg4LjAxMDQyVjIwLjAyMDhIMTYuMDE1NlYxNi4wMTgyWk0yMC4wMTgyIDE2LjAxODJIMjQuMDIwOFYyMC4wMjA4SDIwLjAxODJWMTYuMDE4MlpNMzIuMDI2IDE2LjAxODJIMjguMDIzNFYyMC4wMjA4SDMyLjAyNlYxNi4wMTgyWk00NC4wMzM5IDE2LjAxODJWMjAuMDIwOEgzNi4wMjg2VjE2LjAxODJINDQuMDMzOVpNMTIuMDEzIDI0LjAyMzRIOC4wMTA0MlYyOC4wMjZIMTIuMDEzVjI0LjAyMzRaTTE2LjAxNTYgMjQuMDIzNEgzNi4wMjg2VjI4LjAyNkgxNi4wMTU2VjI0LjAyMzRaTTQ0LjAzMzkgMjQuMDIzNEg0MC4wMzEyVjI4LjAyNkg0NC4wMzM5VjI0LjAyMzRaIiBmaWxsPSIjNDI0MjQyIi8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDAiPgo8cmVjdCB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg=="},51096:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCA1MyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwKSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNDguMDM2NCA0LjAxMDQySDQuMDA3NzlMNC4wMDc3OSAzMi4wMjg2SDQ4LjAzNjRWNC4wMTA0MlpNNC4wMDc3OSAwLjAwNzgxMjVDMS43OTcyMSAwLjAwNzgxMjUgMC4wMDUxODc5OSAxLjc5OTg0IDAuMDA1MTg3OTkgNC4wMTA0MlYzMi4wMjg2QzAuMDA1MTg3OTkgMzQuMjM5MiAxLjc5NzIxIDM2LjAzMTIgNC4wMDc3OSAzNi4wMzEySDQ4LjAzNjRDNTAuMjQ3IDM2LjAzMTIgNTIuMDM5IDM0LjIzOTIgNTIuMDM5IDMyLjAyODZWNC4wMTA0MkM1Mi4wMzkgMS43OTk4NCA1MC4yNDcgMC4wMDc4MTI1IDQ4LjAzNjQgMC4wMDc4MTI1SDQuMDA3NzlaTTguMDEwNDIgOC4wMTMwMkgxMi4wMTNWMTIuMDE1Nkg4LjAxMDQyVjguMDEzMDJaTTIwLjAxODIgOC4wMTMwMkgxNi4wMTU2VjEyLjAxNTZIMjAuMDE4MlY4LjAxMzAyWk0yNC4wMjA4IDguMDEzMDJIMjguMDIzNFYxMi4wMTU2SDI0LjAyMDhWOC4wMTMwMlpNMzYuMDI4NiA4LjAxMzAySDMyLjAyNlYxMi4wMTU2SDM2LjAyODZWOC4wMTMwMlpNNDAuMDMxMiA4LjAxMzAySDQ0LjAzMzlWMTIuMDE1Nkg0MC4wMzEyVjguMDEzMDJaTTE2LjAxNTYgMTYuMDE4Mkg4LjAxMDQyVjIwLjAyMDhIMTYuMDE1NlYxNi4wMTgyWk0yMC4wMTgyIDE2LjAxODJIMjQuMDIwOFYyMC4wMjA4SDIwLjAxODJWMTYuMDE4MlpNMzIuMDI2IDE2LjAxODJIMjguMDIzNFYyMC4wMjA4SDMyLjAyNlYxNi4wMTgyWk00NC4wMzM5IDE2LjAxODJWMjAuMDIwOEgzNi4wMjg2VjE2LjAxODJINDQuMDMzOVpNMTIuMDEzIDI0LjAyMzRIOC4wMTA0MlYyOC4wMjZIMTIuMDEzVjI0LjAyMzRaTTE2LjAxNTYgMjQuMDIzNEgzNi4wMjg2VjI4LjAyNkgxNi4wMTU2VjI0LjAyMzRaTTQ0LjAzMzkgMjQuMDIzNEg0MC4wMzEyVjI4LjAyNkg0NC4wMzM5VjI0LjAyMzRaIiBmaWxsPSIjQzVDNUM1Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDAiPgo8cmVjdCB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg=="}}]);