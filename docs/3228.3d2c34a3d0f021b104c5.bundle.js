(self.webpackChunkKuiClientTemplate=self.webpackChunkKuiClientTemplate||[]).push([[3228],{51956:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>p,doExec:()=>v});var o=t(11227),i=t.n(o),s=t(37767),c=t(18495);const r=i()("plugins/bash-like/util/json");var d=t(67712),l=t(186),a=function(e,n,t,o){return new(t||(t=Promise))((function(i,s){function c(e){try{d(o.next(e))}catch(e){s(e)}}function r(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,r)}d((o=o.apply(e,n||[])).next())}))};const u=i()("plugins/bash-like/cmds/general");const v=(e,n,t)=>t.onInit||t.onExit||!c.Capabilities.isHeadless()||c.Capabilities.inProxy()?new Promise(((n,o)=>a(void 0,void 0,void 0,(function*(){try{const i={maxBuffer:1048576,cwd:t.cwd,env:Object.assign({},l.env,t.env||{})};l.env.SHELL&&(i.shell=l.env.SHELL);const c=(0,s.exec)(e,i);let d,v="",f="";t.onInit&&(u("setting up stdout via onInit",e.slice(0,10)),d=Promise.resolve(t.onInit({abort:()=>c.kill(),xon:()=>{},xoff:()=>{},write:()=>{}}))),t.pipeStdin&&l.stdin.pipe(c.stdin),c.stdout.on("data",(e=>a(void 0,void 0,void 0,(function*(){const n=e.toString();d?(yield d)(e):v+=n})))),c.stderr.on("data",(e=>a(void 0,void 0,void 0,(function*(){f+=e,t.stderr?t.stderr(e.toString()):d?(yield d)(e.toString()):u(e.toString())})))),c.on("error",o),c.on("close",(i=>a(void 0,void 0,void 0,(function*(){if(t.onExit)return u("onExit",i,e.slice(0,10)),void t.onExit(i);if(0===i)if(t&&t.json)try{n(JSON.parse(v))}catch(e){const n=new Error("unexpected non-JSON");n.value=v,o(n)}else if(t&&t.raw)n(v);else if(v||f){const e=(e=>{const n=e.substring(e.indexOf("{"));if(n.length>0)try{const e=JSON.parse(n);return r("successfully parsed out json",e),e}catch(e){}})(v);e&&"object"==typeof e?(e.type="shell",e.verb="get",n(e)):n(v)}else n(!0);else{u("non-zero exit code",i);const e=f.replace(/(^\/[^/]+\/[^:]+: )(line \d+: )?/,"");try{((e,n,t,o,i,s)=>{const c=0===o.length?t:o;if(i&&i.nested&&n<127){const e=new Error(c);throw e.code=n,e}{const e=new Error(c);throw e.html=s,i.stderr?e.code=s:/File exists/i.test(c)?e.code=409:127!==n&&/not found/i.test(c)?e.code=404:e.code=n,e}})(0,i,v,e,t)}catch(e){o(e)}}}))))}catch(e){o(e)}})))):function(e,n){return new Promise(((t,o)=>a(this,void 0,void 0,(function*(){try{const i={cwd:n.cwd,env:Object.assign({},l.env,n.env||{})};l.env.SHELL&&e.find((e=>/&&|>|\||`|\$/.test(e)))&&(i.shell=l.env.SHELL),n.onInit||n.onExit||!c.Capabilities.isHeadless()||c.Capabilities.inProxy()||(i.stdio="inherit");const r=(0,s.spawn)(e[0],e.slice(1),i);r.on("error",o),r.on("close",(e=>a(this,void 0,void 0,(function*(){0===e?t(!0):o(new Error(`non-zero exit code: ${e}`))}))))}catch(e){o(e)}}))))}(n,t),f=e=>{if(e.execOptions.type===c.ExecType.TopLevel)throw new Error("this command is intended for internal consumption only");return(0,d.XN)(e)},p=e=>{e.listen("/!",d.XN,{docs:"Execute a UNIX shell command",requiresLocal:!0}),e.listen("/sendtopty",f,{docs:"Execute a UNIX shell command with a PTY",hidden:!0}),e.listen("/pwd",(()=>l.env.PWD||l.env.HOME||"/"))}},37767:()=>{}}]);