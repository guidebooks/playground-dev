"use strict";(self.webpackChunkKuiClientTemplate=self.webpackChunkKuiClientTemplate||[]).push([[2137,403],{40403:(e,t,a)=>{a.r(t),a.d(t,{getNodeData:()=>y,getSystemOverhead:()=>p,strip:()=>h,topNode:()=>f});var n=a(18495),r=a(53450),o=a(67294);function i(e,t){return o.createElement("span",null,e,o.createElement("span",{className:"even-lighter-text"},"ï¼"),t)}function c(e){return function(e){return"number"==typeof e.fraction}(e)?100*e.fraction+"%":e.fractionString}function u(e){const t={backgroundColor:e.color,bodrerRight:"1px solid var(--color-stripe-02)",width:c(e)};return o.createElement("div",{style:{display:"flex",backgroundColor:"var(--color-stripe-01)",height:"1em",width:"5em"}},o.createElement("div",{style:t}))}function s(e){const t={display:"flex",flexDirection:e.flexDirection||"column",justifyContent:e.alignment||"space-between"};return e.onClick?o.createElement("a",{style:t,href:"#",onClick:()=>(0,n.getCurrentTab)().REPL.pexec(e.onClick)},e.children):o.createElement("div",{style:t},e.children)}function l(e){return o.createElement(s,{alignment:"center",flexDirection:"row"},o.createElement(u,Object.assign({},e)),e.text&&o.createElement("span",{className:"even-smaller-text sub-text small-left-pad"},c(e)))}function d(e){return o.createElement(l,Object.assign({},e))}var b=function(e,t,a,n){return new(a||(a=Promise))((function(r,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function c(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,c)}u((n=n.apply(e,t||[])).next())}))};const m=(0,n.i18n)("plugin-kubectl","view-utilization-table");function y(e,t=!1,a=""){return b(this,void 0,void 0,(function*(){const{parsedOptions:n,REPL:r}=e,o=n.l||n.selector||n.label,i=o?`-l ${o}`:"",c=n.context?`--context ${n.context}`:"",u="{'\\\\t'}",s=`kubectl ${c} get nodes ${i} ${(t?"--field-selector=spec.unschedulable=false":"")+(a?t?"":`--field-selector=metadata.name=${a}`:"")} -o=jsonpath={range .items[*]}{.metadata.name}${u}{.status.allocatable.cpu}${u}{.status.allocatable.memory}${u}{.status.capacity.cpu}${u}{.status.capacity.memory}{'\\\\n'}{end}`;return function(e,t,a){return{title:"Nodes",header:{name:"Node",attributes:[{value:"CPU"},{value:"Memory"}]},body:e.split(/\n/).map((e=>{const[n,r,o,i,c]=e.split(/\t/);return{name:n,onclick:`kubectl get node ${n} -o yaml ${a} ${t}`,attributes:[{key:"cpuAllocatable",value:r},{key:"memoryAllocatable",value:o},{key:"cpuCapacity",value:i},{key:"memoryCapacity",value:c}]}}))}}(yield r.qexec(s),i,c)}))}function p(e,t,a=!1){return b(this,void 0,void 0,(function*(){const n=yield y(e,a,t),o=n.body.reduce(((e,t)=>e+r._b.cpuShare(t.attributes[2].value)-r._b.cpuShare(t.attributes[0].value)),0),i=n.body.reduce(((e,t)=>e+r._b.cpuShare(t.attributes[2].value)),0);return{cpuOverhead:o,memOverhead:n.body.reduce(((e,t)=>e+r._b.memShare(t.attributes[3].value)-r._b.memShare(t.attributes[1].value)),0),cpuCapacity:i,memCapacity:n.body.reduce(((e,t)=>e+r._b.memShare(t.attributes[3].value)),0)}}))}function h(e,t,a=0){e.command=0===a?e.command.replace(t,""):e.command.replace(new RegExp(`${t}\\s+\\S+`),""),e.argv.splice(e.argv.indexOf(t),a+1)}function f(e,t){return b(this,void 0,void 0,(function*(){if(e.parsedOptions.summary)return function(e,t){return b(this,void 0,void 0,(function*(){h(e,"--summary");const a=yield t(e);return{mode:"raw",content:{cpuFrac:a.body.reduce(((e,t)=>e+r._b.cpuFraction(t.attributes[1].value)),0)/a.body.length/100,memFrac:a.body.reduce(((e,t)=>e+r._b.cpuFraction(t.attributes[3].value)),0)/a.body.length/100}}}))}(e,t);const[a,n]=yield Promise.all([t(e),y(e,!0)]);a.header.attributes.push({outerCSS:"hide-with-sidecar not-displayed",key:"Allocatable CPU",value:m("Allocatable CPU")}),a.header.attributes.push({outerCSS:"hide-with-sidecar not-displayed",key:"Allocatable Memory",value:m("Allocatable Memory")});const o=a.header.attributes.findIndex((e=>"CPU(cores)"===e.key));o>=0&&(a.header.attributes[o].outerCSS=`${a.header.attributes[o].outerCSS||""} hide-with-sidecar`);const c=a.header.attributes.findIndex((e=>"MEMORY(bytes)"===e.key));c>=0&&(a.header.attributes[c].outerCSS=`${a.header.attributes[c].outerCSS||""} hide-with-sidecar`);const u=a.header.attributes.findIndex((e=>"MEMORY%"===e.key));return a.header.attributes[u].outerCSS=a.header.attributes[u].outerCSS.replace(/hide-with-sidecar/,""),a.body.forEach((t=>{t.onclick=`kubectl top pod --node ${e.REPL.encodeComponent(t.name)}`;const a=t.attributes.find((e=>"CPU(cores)"===e.key));a&&(a.outerCSS=`${a.outerCSS||""} hide-with-sidecar`);const o=t.attributes.find((e=>"CPU%"===e.key));o&&(o.valueDom=d({color:"var(--color-latency-0)",fractionString:o.value,text:!0}));const c=t.attributes.find((e=>"MEMORY%"===e.key));c&&(c.valueDom=d({color:"var(--color-latency-1)",fractionString:c.value,text:!0}));const u=n.body.find((e=>e.name===t.name));u&&(t.attributes[0].valueDom=i(t.attributes[0].value,u.attributes[2].value),t.attributes[2].valueDom=i(t.attributes[2].value,r._b.formatAsBytes(r._b.memShare(u.attributes[3].value))),t.attributes[3].outerCSS=t.attributes[2].outerCSS.replace(/hide-with-sidecar/,""),t.attributes.push({outerCSS:"not-displayed",key:"Allocatable CPU",value:void 0===u?"&emdash;":u.attributes[2].value}),t.attributes.push({outerCSS:"not-displayed",key:"Allocatable Memory",value:void 0===u?"&emdash;":r._b.formatAsBytes(r._b.memShare(u.attributes[3].value))}))})),a}))}},2137:(e,t,a)=>{a.r(t),a.d(t,{topPod:()=>m,topContainer:()=>y});var n=a(18495),r=a(53450),o=a(40403),i=function(e,t,a,n){return new(a||(a=Promise))((function(r,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function c(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,c)}u((n=n.apply(e,t||[])).next())}))};const c=(0,n.i18n)("plugin-kubectl","view-utilization-table");function u(e,t){return i(this,void 0,void 0,(function*(){const{content:a}=yield e.REPL.rexec(`kubectl get pods -o json -n ${yield(0,r.D_)(e)} ${(0,r.xT)(e)}`),n={};return a&&a.items?a.items.filter((e=>e.spec.nodeName===t)).map((e=>e.metadata.name)).reduce(((e,t)=>(e[t]=!0,e)),n):n}))}function s(e){const t=Object.assign({},e);return t.command=t.command+" -A",t.argv=t.argv.slice(0).concat(["-A"]),t}const l=["processing-text","semi-bold"];function d(e,t,a,n,o,i="share"){const u=JSON.parse(JSON.stringify(e.body[0]));u.onclick=!1,u.rowKey=t,u.name=c(t),u.attributes[0].value="share"===i?r._b.formatAsCpu(a):(100*a).toFixed(0)+"%",u.attributes[1].value="share"===i?r._b.formatAsBytes(n):(100*n).toFixed(0)+"%",o&&(u.css=o,u.attributes[0].css=o.join(" "),u.attributes[1].css=o.join(" ")),e.body.push(u)}function b(e,t,a){return i(this,void 0,void 0,(function*(){if(t.body&&t.body.length>0){const n=t.body.reduce(((e,t)=>e+r._b.cpuShare(t.attributes[0].value)),0),o=t.body.reduce(((e,t)=>e+r._b.memShare(t.attributes[1].value)),0);if(d(t,"Total",n,o),a.body&&a.body.length>0){const n=yield(0,r.D_)(e),o=a.body.filter((e=>e.name!==n)),i=o.reduce(((e,t)=>e+r._b.cpuShare(t.attributes[1].value)),0),c=o.reduce(((e,t)=>e+r._b.memShare(t.attributes[2].value)),0);d(t,"Other Namespaces",i,c,l)}}return t}))}function m(e,t){return i(this,void 0,void 0,(function*(){const a=(0,o.getSystemOverhead)(e,e.parsedOptions.node),m=e.parsedOptions.node?yield function(e,t){return i(this,void 0,void 0,(function*(){const a=e.parsedOptions.node;if((0,o.strip)(e,"--node",1),(0,r.Dk)(e.parsedOptions)||e.parsedOptions.containers){const[n,r]=yield Promise.all([t(e),u(e,a)]);return n.body&&(n.body=n.body.filter((e=>r[e.name]))),n}{const[n,r,o]=yield Promise.all([t(e),u(e,a),t(s(e))]);return n.body&&(n.body=n.body.filter((e=>r[e.name]))),o.body&&(o.body=o.body.filter((e=>r[e.attributes[0].value]))),b(e,n,o)}}))}(e,t):yield function(e,t){return i(this,void 0,void 0,(function*(){if((0,r.Dk)(e.parsedOptions)||e.parsedOptions.containers)return t(e);{const[a,n]=yield Promise.all([t(e),t(s(e))]);return b(e,a,n)}}))}(e,t);if(!(0,n.isTable)(m))return m;if(0===m.body.length)throw new Error(c("No pods found"));const y=yield(0,r.D_)(e);m.body.forEach((t=>{t.onclick&&(t.onclick=`kubectl top container ${e.REPL.encodeComponent(t.name)} -n ${y} ${(0,r.xT)(e)}`)}));const{cpuOverhead:p,memOverhead:h}=yield a;d(m,"System Overheads",p,h,l);const f=m.body.find((e=>"Total"===e.rowKey)),v=m.body.find((e=>"Other Namespaces"===e.rowKey));if(f&&v){const e=r._b.cpuShare(f.attributes[0].value)+r._b.cpuShare(v.attributes[0].value)+p,t=r._b.memShare(f.attributes[1].value)+r._b.memShare(v.attributes[1].value)+h;d(m,c("Overall Total"),e,t,l)}return m}))}function y(e){return i(this,void 0,void 0,(function*(){const t=e.command.replace("top container","top pod").replace(/(-A|--all-namespaces)/,"")+" --containers",a=yield e.REPL.qexec(t),n=e.argvNoOptions[e.argvNoOptions.indexOf("container")+1];return a.body&&(a.body=a.body.filter((e=>e.name===n)),a.body.forEach((t=>{t.onclick=`kubectl get pod ${e.REPL.encodeComponent(t.name)} -o yaml`}))),a}))}}}]);